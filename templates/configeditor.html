{% extends "base.html" %}
{% from 'macros.html' import nav_button %}

{%block stylesheets %}
<link rel="stylesheet" href="/static/css/configeditor.css">
{%endblock%}

{%block title %}
<title>OP-Z Config Editor</title>
{%endblock%}

{% block main %}
<h1>OP-Z Config Editor</h1>

{{ nav_button('/', 'Home Page') }}
<button id="save-button" class="btn btn-secondary">Save Changes</button>

<div id="device-error-container" class="error-container container" hidden>
    <p id="device-error-message">OP-Z not configured. Please configure your OP-Z in <a href="/utilitysettings" class="btn btn-danger">Utility Settings</a></p>
</div>

<div id="main-content">


<div id="config-container">
  <!-- First Row: General and MIDI side by side -->
  <div class="config-row">
    <!-- General Config Section -->
    <div class="config-section-wrapper">
      <div class="config-section">
        <h3>General Config</h3>
        <form id="general-form" class="config-form-inner"></form>
      </div>
    </div>

    <!-- MIDI Config Section -->
    <div class="config-section-wrapper">
      <div class="config-section">
        <h3>MIDI Config</h3>
        <form id="midi-form" class="config-form-inner"></form>
      </div>
    </div>
  </div>

  <!-- Second Row: DMX full width -->
  <div class="config-section-wrapper full-width">
    <div class="config-section">
      <h3>DMX Config</h3>
      <div class="config-form-inner">
        <textarea id="dmx-textarea" placeholder="DMX configuration will load here..."></textarea>
      </div>
    </div>
  </div>
</div>
</div>

<script>
// Check if OP-Z is configured before allowing access
async function checkDeviceRequirement() {
    try {
        const res = await fetch('/get-config-setting?config_option=OPZ_MOUNT_PATH');
        const data = await res.json();
        const isSet = data.config_value && data.config_value !== '';

        if (!isSet) {
            document.getElementById('device-error-container').hidden = false;
            document.getElementById('main-content').hidden = true;
        }
    } catch (error) {
        console.error('Error checking device configuration:', error);
    }
}
checkDeviceRequirement();
</script>

<script src="/static/js/configeditor.js"></script>

{% endblock %}

</html>